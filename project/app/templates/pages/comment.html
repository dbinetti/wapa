{% extends 'base.html' %}
{% load bootstrap4 %}
{% load static %}
{% load app_tags %}
{% load cloudinary %}

{% block metatags %}
  <meta property="og:title" content="Support the Superintendent" />
  <meta property="og:image" content='{% static "app/compare3.png" %}' />
  <meta property="og:image:secure_url" content='{% static "app/compare3.png" %}' />
  <meta property="og:url" content="https://www.westadaparents.com" />
  <meta property="og:type" content="website" />
  <meta property="fb:app_id" content="1236648860100768" />
  <meta property="og:description" content="Send a Message to Dr. Bub to keep schools open and masks-optional." />
{% endblock metatags %}

{% block customstyles %}
{% endblock customstyles %}


{% block title %}Comment by {{comment.account.name}}{% endblock title %}

{% block content %}
  <section class='my-5 col-md-12'>
    <div class='card'>
      <h4 class='card-header'>
        Comment to {{comment.issue.recipient_name}}
      </h4>
      <div class="card-body">
        <div class='card-text'>
          <div class='row'>
            <div class='col-md-3'>
              {% cloudinary comment.account.picture.name AVATAR %}
              <p>
                <strong>{{comment.account.name}}</strong>
              </p>
              <p>
                {% for student in comment.account.students.all %}
                  {% if student.school.get_kind_display == 'Elementary School' %}
                    <span class='badge badge-warning badge-pill'>{{ student.school.name }} {{student.ord|default:"" }}</span><br>
                  {% elif student.school.get_kind_display == 'Middle School' %}
                    <span class='badge badge-success badge-pill'>{{ student.school.name }} {{student.ord|default:"" }}</span><br>
                  {% elif student.school.get_kind_display == 'High School' %}
                    <span class='badge badge-info badge-pill'>{{ student.school.name }} {{student.ord|default:"" }}</span><br>
                  {% endif %}
                {% endfor %}
              </p>
            </div>
            <div class='col-md-9'>
              <blockquote class="blockquote mb-0">
                <p>
                  "{{comment.content}}"
                </p>
                <footer class="blockquote-footer">Sent on {{comment.updated}}</footer>
              </blockquote>
            </div>
          </div>
        </div>
      </div>
      <div class='card-footer'>
        <ul class='list-inline '>
          <li class='list-inline-item'>
            {% bootstrap_button "Share This Comment on Facebook" button_type='link' href=comment_delete size='large' button_class='btn-primary' extra_classes='ml-3' id='facebook-share-button'%}
          </li>
        </ul>
      </div>
    </div>
  </section>
  <section class='my-5 col-md-12'>
      <div class='mt-3'>
        <a href='{% url "join" %}' class="btn btn-success btn-block btn-lg p-3">
          <strong>Click to Message the Superintendent and <br>Join <span id='value'></span> Other Parents Who Want Smiling Kids in Open Schools</strong>
        </a>
      </div>
  </section>
{% endblock content %}

{% block scripts %}
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
  <script>
    window.fbAsyncInit = function() {
      FB.init({
        appId            : '{% get_env_var "FACEBOOK_CLIENT_ID" %}',
        autoLogAppEvents : true,
        xfbml            : true,
        version          : 'v11.0'
      });
    };
  </script>
  <script>
    const FBbutton = document.querySelector('#facebook-share-button');
    FBbutton.addEventListener('click', async () => {
      FB.ui({
        method: "share",
        href: "https://www.westadaparents.com/comment/{{comment.id}}",
        quote: "{{comment.content|escapejs}}",
      }, function(response){});
    });
  </script>
  <script>
    function animateValue(obj, start, end, duration) {
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        obj.innerHTML = Math.floor(progress * (end - start) + start);
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    }
    const obj = document.getElementById("value");
    animateValue(obj, 0, {{count}}, 2500);
  </script>
{% endblock scripts %}
