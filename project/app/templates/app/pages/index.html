{% extends 'app/pages/base.html' %}
{% load static %}
{% load humanize %}
{% load app_tags %}

{% block metatags %}
  <meta property="og:title" content="West Ada Parents Support our Superintendent" />
  <meta property="og:image" content='{% static "app/poster2.png" %}' />
  <meta property="og:image:secure_url" content='{% static "app/poster2.png" %}' />
  <meta property="og:url" content="https://www.westadaparents.com" />
  <meta property="og:type" content="website" />
  <meta property="fb:app_id" content="1236648860100768" />
  <meta property="og:description" content="Click to keep Schools Open and Kids Smiling." />
{% endblock metatags %}


{% block customstyles %}
{% endblock customstyles %}


{% block title %}{% endblock title%}

{% block content %}
  <section class 'mt-5'>
    <div id='id_wistia'>
      <script src="https://fast.wistia.com/embed/medias/twi5pl6yqf.jsonp" async></script><script src="https://fast.wistia.com/assets/external/E-v1.js" async></script><div class="wistia_responsive_padding" style="padding:56.25% 0 0 0;position:relative;"><div class="wistia_responsive_wrapper" style="height:100%;left:0;position:absolute;top:0;width:100%;"><div class="wistia_embed wistia_async_twi5pl6yqf videoFoam=true" style="height:100%;position:relative;width:100%"><div class="wistia_swatch" style="height:100%;left:0;opacity:0;overflow:hidden;position:absolute;top:0;transition:opacity 200ms;width:100%;"><img src="https://fast.wistia.com/embed/medias/twi5pl6yqf/swatch" style="filter:blur(5px);height:100%;object-fit:contain;width:100%;" alt="" aria-hidden="true" onload="this.parentNode.style.opacity=1;" /></div></div></div></div>
    </div>
    <div class='jumbotron'>
      {% comment %}
      <div class='mb-3'>
          <div class='mb-3 mx-3'>
            <p>
              <strong>West Ada Parents Support our Superintendent!</strong> <a href='{% url "join" %}'>Join Us</a> to show your support for Open Schools and Smiling Kids.
            </p>
          </div>
      </div>
      {% endcomment %}
      <div class='mt-3'>
        <a href='{% url "join" %}' class="btn btn-success btn-block btn-lg p-3">
          {# <strong>Click to Join <span id='value'></span> Parents Who Want Smiling Kids in Open Schools</strong> #}
          Click Here to Write a Comment
        </a>
      </div>
    </div>
  </section>
  <section class='m-3'>
    <table class='table'>
      <thead>
        <tr class='row'>
          <th scope='col' class='col-5'>Name</th>
          <th scope='col' class='col-7'>Comments</th>
        </tr>
      </thead>
      <tbody>
        {% for comment in comments %}
          <tr class='row'>
            <td class='col-5'>
              {{comment.account.name}}<br>
              <ul class='list-inline'>
                {% if comment.account.role == 1 %}
                  <li class='list-inline-item'>
                      <span class="badge badge-warning">Parent</span>
                  </li>
                {% elif comment.account.role == 2 %}
                  <li class='list-inline-item'>
                      <span class="badge badge-success">Student</span>
                  </li>
                {% elif comment.account.role == 3 %}
                  <li class='list-inline-item'>
                      <span class="badge badge-danger">Teacher</span>
                  </li>
                {% endif %}
                {% for student in comment.account.students.all %}
                  <li class='list-inline-item'>
                      <span class="badge badge-warning">{{student.school.name}} {{student.get_grade_display}}</span>
                  </li>
                {% endfor %}
                {% if comment.account.is_voter %}
                  <li class='list-inline-item'>
                      <span class="badge badge-primary">Registered Voter</span>
                  </li>
                {% endif %}
                {% if comment.account.zone %}
                  <li class='list-inline-item'>
                    <span class="badge badge-light">{{account.get_zone_display}}</span>
                  </li>
                {% endif %}
              </ul>
            </td>
            <td class='col-7'>
              {% if comment.polymorphic_ctype.name == 'Written Comment' %}
                {% if comment.wordcount < 31 %}
                  {{comment.text}}
                {% else %}
                  <div class="collapse show" id="comment-{{comment.id}}">
                    {{comment.text|truncatewords:30}}
                  </div>
                  <div class="collapse" id="comment-{{comment.id}}">
                    {{comment.text}}
                  </div>
                  <a data-toggle="collapse" href="#comment-{{comment.id}}"><small>more</small></a>
                {% endif %}
              {% else %}
                <video
                  id="comment-player"
                  controls
                  class="cld-video-player"
                  data-cld-public-id="{{comment.video.name}}"
                >
                </video>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

{% endblock content %}

{% block scripts %}
  <script src="https://unpkg.com/cloudinary-core/cloudinary-core-shrinkwrap.min.js" type="text/javascript"></script>
  <script src="https://unpkg.com/cloudinary-video-player/dist/cld-video-player.min.js" type="text/javascript"></script>
  <script>
    let cloudName = '{% get_env_var "CLOUDINARY_NAME"%}';
    let cld = cloudinary.Cloudinary.new({
      cloud_name: cloudName
    });
    let  players = cld.videoPlayers('.cld-video-player', {
      showLogo: false,
      sourceTypes: ['hls', 'dash'],
      sourceTransformation: {
        'hls': [{ streaming_profile: 'hd' }],
        'dash': [{ streaming_profile: 'hd' }],
      }
    });
  </script>
  <script>
    function animateValue(obj, start, end, duration) {
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        obj.innerHTML = Math.floor(progress * (end - start) + start);
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    }

    const obj = document.getElementById("value");
    animateValue(obj, 0, {{count}}, 2500);
  </script>
{% endblock scripts %}
