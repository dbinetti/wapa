{% extends 'app/pages/base.html' %}
{% load static %}
{% load cloudinary %}

{% block metatags %}
  <meta property="og:title" content="Support the Superintendent" />
  <meta property="og:image" content='{% cloudinary "wapa/poster" POSTER %}' />
  <meta property="og:image:secure_url" content='{% cloudinary "wapa/poster" POSTER %}' />
  <meta property="og:url" content="https://www.westadaparents.com" />
  <meta property="og:type" content="website" />
  <meta property="fb:app_id" content="1236648860100768" />
  <meta property="og:description" content="Send a Message to Dr. Bub to keep schools open and masks-optional." />
{% endblock metatags %}


{% block customstyles %}
{% endblock customstyles %}


{% block title %}{% endblock title%}

{% block content %}
  <section class 'mt-5'>
    <div id='id_wistia'>
      <script src="https://fast.wistia.com/embed/medias/twi5pl6yqf.jsonp" async></script><script src="https://fast.wistia.com/assets/external/E-v1.js" async></script><div class="wistia_responsive_padding" style="padding:56.25% 0 0 0;position:relative;"><div class="wistia_responsive_wrapper" style="height:100%;left:0;position:absolute;top:0;width:100%;"><div class="wistia_embed wistia_async_twi5pl6yqf videoFoam=true" style="height:100%;position:relative;width:100%"><div class="wistia_swatch" style="height:100%;left:0;opacity:0;overflow:hidden;position:absolute;top:0;transition:opacity 200ms;width:100%;"><img src="https://fast.wistia.com/embed/medias/twi5pl6yqf/swatch" style="filter:blur(5px);height:100%;object-fit:contain;width:100%;" alt="" aria-hidden="true" onload="this.parentNode.style.opacity=1;" /></div></div></div></div>
    </div>
    <div class='jumbotron'>
      {% comment %}
      <div class='mb-3'>
          <div class='mb-3 mx-3'>
            <p>
              <strong>West Ada Parents Support our Superintendent!</strong> <a href='{% url "join" %}'>Join Us</a> to show your support for Open Schools and Smiling Kids.
            </p>
          </div>
      </div>
      {% endcomment %}
      <div class='mt-3'>
        <a href='{% url "join" %}' class="btn btn-success btn-block btn-lg p-3 shadow-lg">
          <strong>Click to Message the Superintendent and <br>Join <span id='value'></span> Other Parents Who Want Smiling Kids in Open Schools</strong>
        </a>
      </div>
    </div>
  </section>
  <section>
    {% cloudinary "wapa/poster" POSTER %}
  </section>
  <section class='m-3'>
    <table class='table'>
      <thead>
        <tr class='row'>
          <th scope='col' class='col-5'>Name</th>
          <th scope='col' class='col-7'>Comments</th>
        </tr>
      </thead>
      <tbody>
        {% for comment in comments %}
          <tr class='row'>
            <td class='col-5'>
              <ul class='list-inline'>
                <li class='list-inline-item align-top'>
                  {% cloudinary comment.account.picture.name AVATAR %}
                </li>
                <li class='list-inline-item'>
                  <strong>{{comment.account.name}}</strong><br>
                  {% for student in comment.account.students.all %}
                    {% if student.school.get_kind_display == 'Elementary School' %}
                      <span class='badge badge-warning badge-pill'>{{ student.school.name }} {{student.ord|default:"" }}</span><br>
                    {% elif student.school.get_kind_display == 'Middle School' %}
                      <span class='badge badge-success badge-pill'>{{ student.school.name }} {{student.ord|default:"" }}</span><br>
                    {% elif student.school.get_kind_display == 'High School' %}
                      <span class='badge badge-info badge-pill'>{{ student.school.name }} {{student.ord|default:"" }}</span><br>
                    {% endif %}
                  {% endfor %}
                </li>
              </ul>
            </td>
            <td class='col-7'>
              {% if comment.wordcount < 60 %}
                {{comment.content}}
              {% else %}
                <div class="collapse show" id="comment-{{comment.id}}">
                  {{comment.content|truncatewords:60}}
                </div>
                <div class="collapse" id="comment-{{comment.id}}">
                  {{comment.content}}
                </div>
                <a data-toggle="collapse" href="#comment-{{comment.id}}"><small>more</small></a>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

{% endblock content %}

{% block scripts %}
  <script>
    function animateValue(obj, start, end, duration) {
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        obj.innerHTML = Math.floor(progress * (end - start) + start);
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    }
    const obj = document.getElementById("value");
    animateValue(obj, 0, {{count}}, 2500);
  </script>
{% endblock scripts %}
