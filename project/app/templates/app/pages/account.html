{% extends 'app/pages/base.html' %}

{% load bootstrap4 %}
{% load cloudinary %}
{% load app_tags %}

{% block formmedia %}
  {{ form.media }}
{% endblock formmedia %}

{% block title %}Account Page{% endblock title %}

{% block content %}
  <section class='mt-5'>
    <h2 class='my-3 col-md-12'>
      Account
    </h2>
    <p class='lead col-md-8'>
      Please review your information, then <a href='{% url "comments" %}'>Send a Comment to the Superintendent</a>.
    </p>
  </section>
  <section class='mt-5 col-md-8'>
    <div class='card'>
      <form method='post'>
        {% csrf_token %}
        <h4 class='card-header'>Personal Profile</h4>
        <div class="card-body">
          <div class='col-xl-6'>
            {% cloudinary account.picture.name params %}
          </div>
          <div class='card-title'>
          </div>
          <div class='card-text'>
              {% bootstrap_form_errors form %}
              {% bootstrap_field form.name show_help=True show_label=False placeholder="Name" %}
              {% bootstrap_field form.is_public show_help=True show_label=False %}
              {% bootstrap_field form.is_spouse show_help=True show_label=False %}
              {% bootstrap_field form.address show_help=True show_label=False %}
              {# {% bootstrap_field form.notes show_help=False show_label=False %} #}
          </div>
        </div>
        <div class='card-footer'>
          {% bootstrap_button "Save" button_type='submit' size='large' %}
          {% bootstrap_button "Cancel" button_type='link' href="/account" size='large' button_class='btn-outline-dark' extra_classes='ml-3'%}
        </div>
      </form>
    </div>
    <div class='text-right'>
      <a href='{% url "delete" %}'><span class='text-danger text-small'>Delete Account</span></a>
    </div>
  </section>
  <section class='my-5 col-md-8'>
    <div class='card'>
      <h4 class='card-header'>
        Your Students
      </h4>
      <div class="card-body">

        <div class='card-title'>
          <p>
            Sharing the schools/grades of your kids increases the power of your message.  This information <strong>always remains private</strong>.
          </p>
        </div>

        <div class='card-text'>
          <table class='table'>
            <thead>
              <tr>
                <th>Name/Initials</th>
                <th>School</th>
                <th>Grade</th>
              </tr>
            </thead>
            <tbody>
              {% for student in students %}
                <tr>
                  <td>
                    <a href='{% url "edit-student" student.id %}'>{{student.name}}</a>
                  </td>
                  <td>
                    {{student.school.name}}
                  </td>
                  <td>
                    {{student.get_grade_display}}
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan=3>
                    (No Students in the District)
                  <td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class='card-footer'>
        <div class='list-inline'>
          {% url 'add-student' as add_student_url %}
          <li class='list-inline-item'>{% bootstrap_button "Add Student" button_type='link' href=add_student_url size='large' button_class='btn-primary' extra_classes='m-2' %}</li>
        </div>
      </div>
    </div>
  </section>
{% endblock content %}

{% block scripts %}
  <script>
    posthog.identify(
      "{{request.user.id|escapejs}}",
      {email: "{{request.user.email|escapejs}}"},
    );
  </script>
{% endblock scripts %}
