{% extends 'app/pages/base.html' %}
{% load bootstrap4 %}
{% load app_tags %}


{% block title %}Submit Video Comment{% endblock title %}

{% block content %}
  <section class='my-5 col-md-8'>
    <div class='card'>
        <h4 class='card-header'>
          Submit Video Comment
        </h4>
      <div class='card-body'>
        <div class='card-title'>
          <p class='lead'>
            We'll post your video and send a copy to the Superintendent:
          </p>
        </div>
        <div>
          <ul class='list-styled'>
            <li><strong>Say directly you support him!</strong></li>
            <li>It must be less than two minutes long.</li>
            <li>Remain respectful and on-topic.</li>
          </ul>
        </div>
      </div>
      <div class='card-footer'>
        <div class='list-inline'>
          <li class='list-inline-item'>
            {% bootstrap_button "Upload" button_type='button' size='large' button_class='btn-primary' id='upload-widget'%}
          </li>
          <li class='list-inline-item'>
            {% bootstrap_button "Cancel" button_type='link' href="/comments" size='large' button_class='btn-outline-dark' extra_classes='ml-3'%}
          </li>
        </div>
      </div>
    </div>
  </section>
{% endblock content %}

{% block scripts %}
  <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
  <script type="text/javascript">
    let cloudName = '{% get_env_var "CLOUDINARY_NAME"%}';
    let cloudPrefix = '{% get_env_var "CLOUDINARY_PREFIX" %}';
    let uploadWidget = cloudinary.createUploadWidget({
        cloudName: cloudName,
        uploadPreset: 'comment_video',
        sources: [
          'local',
          'url',
        ],
        multiple: false,
        folder: `${cloudPrefix}/comments`,
        resourceType: 'video',
        clientAllowedFormats: [
          'video',
        ],
        showPoweredBy: false,
        showUploadMoreButton: false,
      }, (error, result) => {
        if (!error && result && result.event === "success") {
          fetch("video-submission", {
            method: 'POST',
            body: JSON.stringify(result.info)
          }).then(res => {
            window.location.replace('{% url "comments" %}');
          });
        }
      }
    )
    document.getElementById("upload-widget").addEventListener("click", function(){
        uploadWidget.open();
      }, false);
  </script>
{% endblock scripts %}
