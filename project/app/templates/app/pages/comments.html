{% extends 'app/pages/base.html' %}
{% load bootstrap4 %}

{% block customstyles %}
{% endblock customstyles %}


{% block title %}Comments{% endblock title %}

{% block content %}
  <section class='my-5 col-md-12'>
    <div class='card'>
      <h4 class='card-header'>
        Your Public Comments
      </h4>
      <div class="card-body">
        {% comment %}
        <div class='card-title'>
          <p>
            These are your public comments.
          </p>
        </div>
        {% endcomment %}
        <div class='card-text'>
          {% if request.user.account.is_public %}
            <table class='table'>
              <thead>
                <tr>
                  <th>Comment</th>
                  <th>Status</th>
                  <th>Delete</th>
                </tr>
              </thead>
              <tbody>
                {% for personal in personals %}
                  <tr>
                    <td>
                      {{personal.content}}
                    </td>
                    <td>
                      {{ personal.get_state_display }}
                    </td>
                    <td>
                      <a href='{% url "comment-delete" personal.id %}'><span class='text-danger'>Delete</span></a>
                    </td>
                  </tr>
                {% empty %}
                  <tr>
                    <td colspan=3>
                      Click one of the buttons below to make a public comment; once approved, it will appear on the website homepage and be forwarded to the Superintendent.
                    <td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <p>
              (Your <a href='{% url "account" %}'>Account</a> must be public in order to make comments.)
            </p>
          {% endif %}
        </div>
      </div>
      <div class='card-footer'>
        <div class='list-inline'>
          {% url 'submit-written-comment' as written_url_comment %}
          <li class='list-inline-item'>{% bootstrap_button "Write Comment" button_type='link' href=written_url_comment size='large' button_class='btn-success' extra_classes='m-2'%}</li>
        </div>
      </div>
    </div>
  </section>
  <section class='my-5 col-md-12'>
    <div class='card'>
      <h4 class='card-header'>
        All Public Comments
      </h4>
      <div class="card-body">
        <div class='card-text'>
          <table class='table'>
            <thead>
              <tr class='row'>
                <th scope='col' class='col-5'>Name</th>
                <th scope='col' class='col-7'>Comments</th>
              </tr>
            </thead>
            <tbody>
              {% for public in publics %}
                <tr class='row'>
                  <td class='col-5'>
                    {{public.account.name}}<br>
                    <ul class='list-unstyled'>
                      {% if public.account.role == 1 %}
                        <li class='list-inline-item'>
                            <span class="badge badge-warning">Parent</span>
                        </li>
                      {% elif public.account.role == 2 %}
                        <li class='list-inline-item'>
                            <span class="badge badge-success">Student</span>
                        </li>
                      {% elif public.account.role == 3 %}
                        <li class='list-inline-item'>
                            <span class="badge badge-danger">Teacher</span>
                        </li>
                      {% endif %}

                      {% for student in public.account.students.all %}
                        <li>
                            <small>{{student.school.name}} {{student.get_grade_display}}</small>
                        </li>
                      {% endfor %}

                      {% if public.account.zone %}
                        <li class='list-inline-item'>
                          <span class="badge badge-light">{{account.get_zone_display}}</span>
                        </li>
                      {% endif %}
                    </ul>
                  </td>
                  <td class='col-7'>
                    {% if public.wordcount < 60 %}
                      {{public.content}}
                    {% else %}
                      <div class="collapse show" id="public-{{public.id}}">
                        {{public.content|truncatewords:60}}
                      </div>
                      <div class="collapse" id="public-{{public.id}}">
                        {{public.content}}
                      </div>
                      <a data-toggle="collapse" href="#public-{{public.id}}"><small>more</small></a>
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

{% endblock content %}

{% block scripts %}
{% endblock scripts %}
